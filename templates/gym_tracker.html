<!DOCTYPE html>
<html lang="en" data-theme="{{ theme }}">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Workout Tracker</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='unified_theme.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 40px 20px;
    }

    .header {
        text-align: center;
        margin-bottom: 40px;
    }

    .header h1 {
        font-size: 2.5rem;
        margin-bottom: 0.5rem;
    }

    .nav-container {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 40px;
        flex-wrap: wrap;
    }

    .nav-btn {
        padding: 12px 24px;
        background: var(--card-bg);
        color: var(--text-primary);
        text-decoration: none;
        border-radius: 10px;
        font-weight: 600;
        transition: all 0.3s ease;
        border: 1px solid var(--card-border);
        display: inline-flex;
        align-items: center;
        gap: 10px;
    }

    .nav-btn:hover, .nav-btn.active {
        background: var(--primary);
        color: white;
    }

    .form-row {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
        gap: 15px;
    }

    .form-group {
        margin-bottom: 1rem;
    }

    .workouts-container {
        display: grid;
        gap: 15px;
        margin-top: 20px;
    }

    .workout-name {
        font-size: 1.2rem;
        font-weight: 600;
        margin-bottom: 10px;
        color: var(--text-primary);
    }

    .workout-stats {
        color: var(--text-secondary);
        font-size: 1rem;
        margin-bottom: 8px;
    }

    .workout-notes {
        color: var(--text-muted);
        font-size: 0.9rem;
        font-style: italic;
        margin-top: 10px;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--text-muted);
    }

    .empty-state i {
        font-size: 4rem;
        margin-bottom: 20px;
        opacity: 0.5;
    }

    #exerciseSelect {
        margin-bottom: 1rem;
    }
  </style>
</head>
<body>
    <!-- Mode Toggle Button -->
    <div class="mode-toggle" onclick="toggleTheme()">
        <span id="theme-icon">{{ 'üåô' if theme == 'light' else '‚òÄÔ∏è' }}</span>
        <span id="theme-text">{{ 'Dark' if theme == 'light' else 'Light' }}</span>
    </div>

    <div class="container">
      <!-- Header -->
      <div class="header">
        <h1>Workout Tracker</h1>
        <p>Track your strength journey</p>
      </div>

      <!-- Navigation -->
      <div class="nav-container">
        <a href="/" class="nav-btn">
          <i class="fas fa-utensils"></i> Nutrition
        </a>
        <a href="/gym" class="nav-btn active">
          <i class="fas fa-dumbbell"></i> Workout
        </a>
        <a href="/settings" class="nav-btn">
          <i class="fas fa-cog"></i> Settings
        </a>
      </div>

      <!-- Progress Graph -->
      <div class="chart-container">
        <h2><i class="fas fa-chart-line"></i> Weight Progress</h2>
        <div class="form-group">
            <label>Select Exercise</label>
            <select id="exerciseSelect" onchange="loadExerciseProgress()">
                <option value="">Choose an exercise...</option>
            </select>
        </div>
        <canvas id="progressChart"></canvas>
        <p id="noDataMessage" style="text-align: center; color: var(--text-muted); padding: 40px; display: none;">
            <i class="fas fa-info-circle"></i> No progress data available for this exercise yet. Start logging workouts to see your progress!
        </p>
      </div>

      <!-- Log Workout -->
      <div class="section">
        <h2><i class="fas fa-plus-circle"></i> Log Your Workout</h2>

        <form action="/add_workout" method="POST">
          <div class="form-group">
            <label>Exercise Name</label>
            <input type="text" name="exercise" placeholder="e.g., Bench Press, Squats, Deadlift" required>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Weight (lbs)</label>
              <input type="number" step="0.1" name="weight" placeholder="135" required>
            </div>

            <div class="form-group">
              <label>Reps</label>
              <input type="number" name="reps" placeholder="10" required>
            </div>

            <div class="form-group">
              <label>Sets</label>
              <input type="number" name="sets" placeholder="3" required>
            </div>
          </div>

          <div class="form-group">
            <label>Notes (optional)</label>
            <textarea name="notes" placeholder="How did it feel? Any observations?" style="resize: vertical; min-height: 80px;"></textarea>
          </div>

          <button type="submit" class="btn btn-primary">
            <i class="fas fa-dumbbell"></i> Log Workout
          </button>
        </form>
      </div>

      <!-- Today's Workouts -->
      <div class="section">
        <h2><i class="fas fa-list-check"></i> Today's Workouts</h2>

        {% if workouts %}
        <div class="workouts-container">
          {% for workout in workouts %}
          <div class="workout-item">
            <div class="workout-name">
              <i class="fas fa-fire"></i> {{ workout.exercise }}
            </div>
            <div class="workout-stats">
              <i class="fas fa-weight-hanging"></i> {{ workout.weight }} lbs √ó
              <i class="fas fa-redo"></i> {{ workout.reps }} reps √ó
              <i class="fas fa-layer-group"></i> {{ workout.sets }} sets
            </div>
            {% if workout.notes %}
            <div class="workout-notes">
              <i class="fas fa-comment"></i> {{ workout.notes }}
            </div>
            {% endif %}
          </div>
          {% endfor %}
        </div>

        <form action="/clear_workouts" method="GET" style="margin-top: 25px;">
          <button type="submit" class="btn btn-danger" onclick="return confirm('Clear all workouts for today?')">
            <i class="fas fa-trash-alt"></i> Clear All Workouts
          </button>
        </form>
        {% else %}
        <div class="empty-state">
          <i class="fas fa-dumbbell"></i>
          <p>No workouts logged yet. Let's get moving!</p>
        </div>
        {% endif %}
      </div>
    </div>

    <!-- Toast Notification -->
    {% if success_message %}
    <script>
        const messages = {
            'workout_logged': '‚úÖ Workout logged! üí™',
            'workouts_cleared': '‚úÖ All workouts cleared!',
            'theme_updated': '‚úÖ Theme updated!',
            'error': '‚ùå An error occurred. Please try again.',
            'error_weight': '‚ùå Invalid weight!',
            'error_reps': '‚ùå Invalid reps!',
            'error_sets': '‚ùå Invalid sets!',
            'error_empty_exercise': '‚ùå Please enter an exercise name!',
            'error_invalid': '‚ùå Invalid input! Please check your values.'
        };

        const message = messages['{{ success_message }}'] || '‚úÖ Action completed!';
        showToast(message);

        function showToast(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
    </script>
    {% endif %}

    <script>
        let chart = null;

        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';

            html.setAttribute('data-theme', newTheme);
            document.getElementById('theme-icon').textContent = newTheme === 'light' ? 'üåô' : '‚òÄÔ∏è';
            document.getElementById('theme-text').textContent = newTheme === 'light' ? 'Dark' : 'Light';

            // Update chart colors if chart exists
            if (chart) {
                updateChartColors(newTheme);
            }

            // Save preference
            fetch('/update_theme', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: 'theme=' + newTheme
            });
        }

        function updateChartColors(theme) {
            const textColor = theme === 'light' ? '#212529' : '#E9ECEF';
            const gridColor = theme === 'light' ? 'rgba(0, 0, 0, 0.1)' : 'rgba(255, 255, 255, 0.1)';

            chart.options.scales.y.ticks.color = textColor;
            chart.options.scales.x.ticks.color = textColor;
            chart.options.scales.y.grid.color = gridColor;
            chart.options.scales.x.grid.color = gridColor;
            chart.options.plugins.legend.labels.color = textColor;
            chart.update();
        }

        // Load all exercises on page load
        async function loadExercises() {
            try {
                const response = await fetch('/get_all_exercises');
                const exercises = await response.json();

                const select = document.getElementById('exerciseSelect');
                select.innerHTML = '<option value="">Choose an exercise...</option>';

                exercises.forEach(exercise => {
                    const option = document.createElement('option');
                    option.value = exercise;
                    option.textContent = exercise;
                    select.appendChild(option);
                });

                // Auto-select first exercise if available
                if (exercises.length > 0) {
                    select.value = exercises[0];
                    loadExerciseProgress();
                }
            } catch (error) {
                console.error('Error loading exercises:', error);
            }
        }

        async function loadExerciseProgress() {
            const exercise = document.getElementById('exerciseSelect').value;
            const noDataMessage = document.getElementById('noDataMessage');
            const canvas = document.getElementById('progressChart');

            if (!exercise) {
                canvas.style.display = 'none';
                noDataMessage.style.display = 'block';
                noDataMessage.textContent = 'Please select an exercise to view progress.';
                return;
            }

            try {
                const response = await fetch(`/get_exercise_progress/${encodeURIComponent(exercise)}?days=30`);
                const data = await response.json();

                if (data.length === 0) {
                    canvas.style.display = 'none';
                    noDataMessage.style.display = 'block';
                    noDataMessage.innerHTML = '<i class="fas fa-info-circle"></i> No progress data available for this exercise yet. Start logging workouts to see your progress!';
                    return;
                }

                canvas.style.display = 'block';
                noDataMessage.style.display = 'none';

                const labels = data.map(d => d.date);
                const weights = data.map(d => d.weight);

                const theme = document.documentElement.getAttribute('data-theme');
                const textColor = theme === 'light' ? '#212529' : '#E9ECEF';
                const gridColor = theme === 'light' ? 'rgba(0, 0, 0, 0.1)' : 'rgba(255, 255, 255, 0.1)';

                if (chart) {
                    chart.destroy();
                }

                const ctx = canvas.getContext('2d');
                chart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Weight (lbs)',
                            data: weights,
                            borderColor: '#4A90E2',
                            backgroundColor: 'rgba(74, 144, 226, 0.1)',
                            borderWidth: 3,
                            fill: true,
                            tension: 0.4,
                            pointRadius: 5,
                            pointBackgroundColor: '#4A90E2',
                            pointBorderColor: '#fff',
                            pointBorderWidth: 2,
                            pointHoverRadius: 7
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: {
                                display: true,
                                labels: {
                                    color: textColor,
                                    font: {
                                        size: 14,
                                        weight: 'bold'
                                    }
                                }
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                                backgroundColor: 'rgba(0, 0, 0, 0.8)',
                                titleColor: '#fff',
                                bodyColor: '#fff',
                                borderColor: '#4A90E2',
                                borderWidth: 1,
                                padding: 12,
                                displayColors: false
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                ticks: {
                                    color: textColor
                                },
                                grid: {
                                    color: gridColor
                                }
                            },
                            x: {
                                ticks: {
                                    color: textColor
                                },
                                grid: {
                                    color: gridColor
                                }
                            }
                        }
                    }
                });
            } catch (error) {
                console.error('Error loading exercise progress:', error);
                canvas.style.display = 'none';
                noDataMessage.style.display = 'block';
                noDataMessage.textContent = 'Error loading progress data. Please try again.';
            }
        }

        // Load exercises when page loads
        document.addEventListener('DOMContentLoaded', loadExercises);
    </script>
</body>
</html>
